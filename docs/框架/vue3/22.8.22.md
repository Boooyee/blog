# Vue3设计思路
框架设计是权衡的艺术，这里面存在取舍，例如性能与可维护之间的取舍、运行时与编译时之间的取舍。

## 声明式描述UI
用户不需要手写任何命令式代码，这就是所谓的声明式的描述UI

除了使用模板来声明式描述ui之外，我们还可以用js对象来描述。

使用模板和js对象描述Ui有何不同呢，使用js对象描述UI更加灵活，使用模板不得不穷举。

其实我们在Vue组件中手写的渲染函数就是使用的虚拟DOM来描述UI的
```
import { h } from 'vue'
export default {
    render(){
        return h('h1', { onClick: handler })
    }
}
```
h函数的返回值就是一个对象，作用是让我们编写虚拟DOM更加轻松。

## 渲染器

虚拟DOM就是用JS对象来描述真实的DOM结构，那么虚拟DOM是如何变成真实DOM并渲染到浏览器页面的呢，这就需要用到渲染器。

渲染器实现思路：

- 创建元素，把Vnode.tag作为标签名来创建DOM元素
- 为元素添加属性和事件：遍历vnode.props对象，如果key以on字符开头，说明它是一个事件，把名字on截取掉后再调用toLowCase函数将事件名称小写化，最终得到合法的事件名称，例如onClick会变成click，最后调用addEventListener绑定事件处理函数
- 处理children：如果children是一个数组，就递归的调用renderer继续渲染

## 组件的本质

虚拟DOM就是描述真实DOM的普通Js对象，渲染器会把这个对象渲染为真实的DOM元素。那么组件又是什么？组件和虚拟DOM有什么关系？渲染器如何渲染组件？

组件是一组DOM元素的封装，这组DOM元素就是组件要渲染的内容。

## 模板的工作原理
无论是手写虚拟DOM还是使用模板，都属于声明式的描述UI。模板是如何工作的，这就需要提到Vue框架另一个重要组成部分，编译器。

编译器和渲染器一样，就是一段程序，它的作用就是将模板编译为渲染函数。

`<template>`标签里的内容就是模板内容，编译器会把模板内容编译成渲染函数并添加到`<script>`标签块的组件对象上。

无论是使用模板还是直接手写渲染函数，对于一个组件来说，它要渲染的内容最终都是通过渲染函数产生的，然后渲染器再把渲染函数返回的虚拟DOM渲染为真实DOM，这就是模板的工作原理。

## Vue是各个模块组成的有机整体
组件的实现依赖于渲染器，模板的编译依赖于编译器，并且编译后的生成代码是根据渲染器和虚拟DOM的设计决定的。

编译器和渲染器之间是存在信息交流的，他们互相配合使得性能进一步提升，而他们交流的媒介就是虚拟DOM对象。

## 总结
首先介绍了声明式的描述UI的概念。声明式的好处在于，它直接描述结果，用户不需要关注过程。Vue采用模板的方式来描述UI，但它同样支持使用虚拟DOM来描述UI。虚拟DOM要比模板更加灵活，但模板比虚拟DOM更加的直观。

然后我们讲解了最基本的渲染器的实现。渲染器的作用是，把虚拟DOM对象渲染成为真实DOM对象。

组件的本质，组件就是一组虚拟DOM元素的封装，它可以是一个返回虚拟DOM的函数，也可能是一个对象，但这个对象下必须有一个函数用来产出组件要渲染的虚拟DOM。